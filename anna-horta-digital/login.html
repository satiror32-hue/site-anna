<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login Horta ANNA</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1470&q=80') no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal {
      background: rgba(255, 255, 255, 0.95);
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      width: 400px;
      max-width: 90vw;
      text-align: center;
    }

    h2 {
      margin-bottom: 20px;
      color: #333;
    }

    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 12px;
      margin: 10px 0 20px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
      transition: border-color 0.3s;
    }

    input[type="submit"] {
      width: 100%;
      padding: 14px;
      background-color: #4CAF50;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 18px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    .cadastro-btn {
      margin-top: 10px;
      background-color: #2196F3;
      color: white;
      border: none;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .popup {
      background: white;
      padding: 20px 30px;
      border-radius: 12px;
      text-align: center;
      max-width: 300px;
    }

    .popup input {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .popup button {
      margin: 10px 5px 0;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }

    .btn-sim {
      background-color: #4CAF50;
      color: white;
    }

    .btn-nao {
      background-color: #f44336;
      color: white;
    }
  </style>
</head>
<body>

<div class="modal">
  <h2>Login - Horta ANNA</h2>
  <form id="loginForm">
    <input type="text" id="username" placeholder="Usuário" required />
    <input type="password" id="password" placeholder="Senha" required />
    <input type="submit" value="Entrar" disabled />
  </form>
  <button onclick="abrirCPFModal()" class="cadastro-btn">Cadastrar Cliente ou Recuperar Senha</button>
  <div id="loginError" style="color: red; font-weight: bold;"></div>
</div>

<!-- Modal CPF -->
<div class="overlay" id="cpfOverlay">
  <div class="popup" id="popupCPF">
    <p>Digite o CPF:</p>
    <input type="text" id="cpfInput" placeholder="CPF" />
    <button class="btn-sim" onclick="verificarCPF()">Verificar</button>
    <button class="btn-nao" onclick="fecharModal()">Fechar</button>
  </div>
</div>

<!-- Modal Resultado -->
<div class="overlay" id="resultadoOverlay">
  <div class="popup" id="popupResultado">
    <p id="resultadoMensagem"></p>
    <div id="botoesResultado"></div>
  </div>
</div>

<script>
  // Salvar usuários iniciais no localStorage se ainda não tiver
  if (!localStorage.getItem("usuarios")) {
    const iniciais = [
      { user: "cliente1", pass: "1234", tipo: "Cliente", cpf: "11111111111" }, // CPF cadastrado para teste
      { user: "parceiro1", pass: "abcd", tipo: "Parceiro", cpf: "22222222222" },
    ];
    localStorage.setItem("usuarios", JSON.stringify(iniciais));
  }

  function getUsuarios() {
    return JSON.parse(localStorage.getItem("usuarios")) || [];
  }

  // Login
  const loginForm = document.getElementById('loginForm');
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const submitBtn = loginForm.querySelector('input[type="submit"]');

  function toggleSubmit() {
    submitBtn.disabled = !(usernameInput.value && passwordInput.value);
  }

  loginForm.addEventListener('input', toggleSubmit);

  loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();

    // Direcionar coordenador1 para pasta coordenador/index.html
    if (username === "coordenador1" && password === "root") {
      window.location.href = "coordenador/index.html";
      return;
    }

    const usuarios = getUsuarios();
    const usuario = usuarios.find(u => u.user === username && u.pass === password);

    if (usuario) {
      window.location.href = usuario.tipo === "Cliente" ? "pedido_cliente.html" : "ficha_parceiro.html";
    } else {
      document.getElementById('loginError').textContent = "Usuário ou senha inválidos.";
    }
  });

  toggleSubmit();

  // CPF Modal
  function abrirCPFModal() {
    document.getElementById("cpfOverlay").style.display = "flex";
    document.getElementById("cpfInput").value = "";
  }

  function fecharModal() {
    document.getElementById("cpfOverlay").style.display = "none";
  }

  function verificarCPF() {
    const cpf = document.getElementById("cpfInput").value.trim();
    const resultadoOverlay = document.getElementById("resultadoOverlay");
    const resultadoMensagem = document.getElementById("resultadoMensagem");
    const botoesResultado = document.getElementById("botoesResultado");

    fecharModal();

    const usuarios = getUsuarios();
    const usuarioExistente = usuarios.find(u => u.cpf === cpf);

    resultadoOverlay.style.display = "flex";
    botoesResultado.innerHTML = "";

    if (usuarioExistente) {
      resultadoMensagem.innerHTML = `
        CPF já cadastrado!<br>
        Login: <strong>${usuarioExistente.user}</strong><br>
        Senha: <strong>${usuarioExistente.pass}</strong>
      `;
      const btnVoltar = document.createElement("button");
      btnVoltar.textContent = "Voltar para o Login";
      btnVoltar.className = "btn-sim";
      btnVoltar.onclick = () => {
        resultadoOverlay.style.display = "none";
      };
      botoesResultado.appendChild(btnVoltar);
    } else {
      resultadoMensagem.textContent = "CPF não cadastrado. Deseja cadastrar?";
      const btnSim = document.createElement("button");
      btnSim.textContent = "Sim";
      btnSim.className = "btn-sim";
      btnSim.onclick = () => {
        window.location.href = "cadastro_cliente.html";
      };

      const btnNao = document.createElement("button");
      btnNao.textContent = "Não";
      btnNao.className = "btn-nao";
      btnNao.onclick = () => {
        resultadoOverlay.style.display = "none";
      };

      botoesResultado.appendChild(btnSim);
      botoesResultado.appendChild(btnNao);
    }
  }
</script>

</body>
</html>
